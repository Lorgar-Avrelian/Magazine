# Backend часть сайта на Java

### Данный проект выполнен в рамках дипломной работы по курсу java-разработчик онлайн-университета SkyPRO.

## Исходные данные

###### 1. Была выдана frontend-часть, которую необходимо было запускать с помощью установленного Docker, посредством ввода в командную строку следующей команды:

`docker run -p 3000:3000 --rm ghcr.io/bizinmitya/front-react-avito:v1.21`

###### 2. Был выдан исходный шаблон проекта, с fork которого необходимо было работать:

[https://github.com/skypro-backend/example-for-graduate-work](https://github.com/skypro-backend/example-for-graduate-work)

###### 3. Необходимо было скачать openapi.yaml-файл по ссылке:

[https://github.com/dmitry-bizin/front-react-avito/blob/v1.19/openapi.yaml](https://github.com/dmitry-bizin/front-react-avito/blob/v1.19/openapi.yaml)

###### и скопировать его содержимое в https://editor.swagger.io/.

## Текст задания

##### Что необходимо сделать

Нужно написать бэкенд-часть сайта на Java.

##### Бэкенд-часть проекта предполагает реализацию следующего функционала:

1. Авторизация и аутентификация пользователей.
2. Распределение ролей между пользователями: пользователь и администратор.
3. CRUD-операции для объявлений и комментариев: администратор может удалять или редактировать все объявления и
   комментарии, а пользователи — только свои.
4. Возможность для пользователей оставлять комментарии под каждым объявлением.
5. Показ и сохранение картинок объявлений, а также аватарок пользователей.

##### Nice to have

* Код должен быть корректно отформатирован.
* Код проекта не должен содержать дублирований более чем в три строки, общие операции необходимо выносить в сервисы или
  утилитарные методы.
* Переменные и классы должны быть названы корректно, название должно отражать суть класса или переменной.
* Код не должен содержать закомментированных участков, недостижимых инструкций и неиспользуемых методов.
* Код должен следовать принципу SRP: каждый класс должен выполнять одну задачу или работать с одной сущностью.
* Код должен быть покрыт тестами. В данном случае приоритет у интеграционных тестов, но некоторые компоненты — например,
  мапперы — можно тестировать с помощью unit-тестов.

## Ход выполнения проекта

Выполнение проекта проходило поэтапно.

#### Первый этап

На первом этапе были выполнены следующие задачи:

1. Добавлены контроллеры (UsersController, AdsController), а также созданы все API в соответствии с openapi.yaml-файлом.
2. Добавлены необходимые в соответствии с openapi.yaml-файлом DTO (AdDTO, AdsDTO, CommentDTO, CommentsDTO,
   CreateOrUpdateAdDTO, CreateOrUpdateCommentDTO, ExtendedAdDTO, LoginDTO, NewPasswordDTO, RegisterDTO, Role,
   UpdateUserDTO, UserDTO).

#### Второй этап

На втором этапе были выполнены следующие задачи:

1. Подключена база данных (БД) PostgreSQL.
2. Созданы необходимые сущности: пользователь (User), объявление (Ad), комментарий (Comment).
3. Написаны репозитории (UserRepository, AdRepository, CommentRepository) для работы с созданными сущностями.
4. Написаны мапперы (UserMapper, AdMapper, CommentMapper) для конвертации сущностей в DTO, и обратно.

#### Третий этап

На третьем этапе были выполнены следующие задачи:

1. Настроена аутентификация и авторизация пользователя с использованием БД.

> При этом, изначально содержавшаяся в шаблоне настройка Spring Security, была удалена.  
> После чего произведена настройка доступа пользователей с использованием jwt-токена (ветка `feature-services`).  
> Однако, предоставленная для проекта frontend-часть, как оказалось, могла работать только с базовой аутентификацией.
> Поэтому, в ветке `feature-security` настройка Spring Security была изменена с применением Basic Authentication.  
> Аннотация `@PreAuthorize` для разграничения прав администраторов и пользователей не применялась, так как логика
> сервисных методов была построена с использованием служебных методов.

2. Были написаны сервисы (UsersService, AdsService) и их реализации (UsersServiceImpl, AdsServiceImpl), связавшие
   данные, которые приходят в контроллеры в виде DTO, с БД.

#### Четвёртый этап

На четвёртом этапе были выполнены следующие задачи:

1. Реализована обработка получение картинок в контроллерах (UsersController, AdsController).
2. Реализована возможность получать эти картинки из приложения (ImageController, ImageService, ImageServiceImpl).
3. Написаны Javadoc's для всех методов приложения.

#### Пятый этап

1. Написаны Unit-тесты к методам сервисов и интеграционные тесты к приложению.
2. Написан настоящий README.md

## Применённые технологии

|       Наименование       |                                       Название задачи                                       |
|:------------------------:|:-------------------------------------------------------------------------------------------:|
|           Git            |                                  Общая работа над проектом                                  |
|        Hibernate         |                          Настройка взаимодействия приложения с БД                           |
|      HTTP, REST API      |             Построение контроллеров, настройка взаимодействия с frontend-частью             |
| InputStream/OutputStream |                     Приём, обработка, сохранение и передача изображений                     |
|        Java Core         |                                  Построение логики проекта                                  |
|        Liquibase         |                          Настройка взаимодействия приложения с БД                           |
|          Logger          | Логирование ошибок, которые могут возникнуть при работе приложения, с помощью логгера log4j |
|        Mapstruct         |                                    Создание мапперов DTO                                    |
|          Maven           |                                       Сборка проекта                                        |
|       PostgresSQL        |                            Создание БД, настройка доступа к ней                             |
|         Postman          |                      Тестирование работы приложения в ходе разработки                       |
|      Spring Mockito      |                              Unit-тесты и интеграционные тесты                              |
|     Spring Security      |                             Настройка прав доступа в приложении                             |
|        Spring Web        |                                   Построение контроллеров                                   |
|           SQL            |              Создание таблиц в БД, установка первичных и внешних ключей таблиц              |
|          Stream          |                Работа со списком ролей пользователя (ветка feature-services)                |
|        Swagger-UI        |                      Тестирование работы приложения в ходе разработки                       |